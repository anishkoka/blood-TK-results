<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<title>Blood Results Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  :root {
    --bg: #0a0f1a;
    --card: #111827;
    --border: #1e293b;
    --text: #e2e8f0;
    --muted: #94a3b8;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, sans-serif;
    padding: 16px 12px;
    min-height: 100vh;
    -webkit-text-size-adjust: 100%;
  }

  .container { max-width: 960px; margin: 0 auto; }

  .header { display: flex; align-items: center; gap: 10px; margin-bottom: 4px; }

  .header-dot {
    width: 10px; height: 10px; border-radius: 50%;
    background: linear-gradient(135deg, #10b981, #3b82f6);
    box-shadow: 0 0 12px rgba(16,185,129,0.4);
    flex-shrink: 0;
  }

  h1 { font-size: 20px; font-weight: 700; letter-spacing: -0.03em; }

  .subtitle {
    color: var(--muted); font-size: 12px;
    padding-left: 20px; margin-bottom: 16px;
  }

  .stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 8px;
    margin-bottom: 16px;
  }

  .stat-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 12px;
  }

  .stat-label {
    color: var(--muted); font-size: 9px;
    text-transform: uppercase; letter-spacing: 0.05em;
    margin-bottom: 2px;
  }

  .stat-value {
    font-size: 20px; font-weight: 700;
    font-family: 'JetBrains Mono', monospace;
  }

  .stat-unit { color: var(--muted); font-size: 10px; margin-left: 2px; }
  .stat-trend { font-size: 9px; margin-top: 1px; font-weight: 500; }

  .tabs {
    display: flex; gap: 6px; flex-wrap: wrap;
    margin-bottom: 12px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .tab {
    background: #1e293b; color: var(--muted);
    border: 1px solid #334155; border-radius: 8px;
    padding: 7px 14px; font-size: 12px; font-weight: 600;
    cursor: pointer; font-family: inherit;
    white-space: nowrap; flex-shrink: 0;
    transition: all 0.15s ease;
  }

  .tab:active { transform: scale(0.96); }
  .tab.active { background: #1e40af; color: #fff; border-color: #3b82f6; }

  .chart-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px 8px 8px 8px;
    margin-bottom: 12px;
  }

  .chart-header {
    display: flex; align-items: baseline; justify-content: space-between;
    gap: 8px; margin-bottom: 6px; padding: 0 6px;
  }

  .chart-header-left { display: flex; align-items: baseline; gap: 8px; }
  .chart-title { font-size: 14px; font-weight: 700; letter-spacing: -0.02em; }
  .chart-subtitle { color: var(--muted); font-size: 10px; }

  .reset-zoom {
    background: #1e293b; color: var(--muted);
    border: 1px solid #334155; border-radius: 6px;
    padding: 4px 10px; font-size: 10px; font-weight: 600;
    cursor: pointer; font-family: inherit;
    display: none;
  }

  .reset-zoom.visible { display: block; }

  .chart-wrap { position: relative; width: 100%; }
  .chart-wrap canvas { touch-action: pan-y; }

  .events-legend {
    display: flex; gap: 12px; align-items: center;
    padding: 10px 12px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    margin-top: 12px; flex-wrap: wrap;
  }

  .events-legend-title {
    color: var(--muted); font-size: 10px;
    font-weight: 600; text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .event-item { display: flex; align-items: center; gap: 5px; }
  .event-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
  .event-label { font-size: 10px; }

  .zoom-hint {
    color: var(--muted); font-size: 10px;
    text-align: center; margin-top: 8px;
    opacity: 0.7;
  }

  .hidden { display: none !important; }

  @media (max-width: 480px) {
    body { padding: 12px 8px; }
    .stats-row { grid-template-columns: repeat(3, 1fr); }
    .stat-value { font-size: 17px; }
    h1 { font-size: 18px; }
  }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="header-dot"></div>
    <h1>Blood Results Dashboard</h1>
  </div>
  <div class="subtitle">Sep 2000 – Jan 2026 · Last drawn Jan 16, 2026</div>

  <div class="stats-row" id="stats-row"></div>
  <div class="tabs" id="tabs"></div>

  <div id="panel-psa" class="chart-card">
    <div class="chart-header">
      <div class="chart-header-left">
        <span class="chart-title">PSA</span>
        <span class="chart-subtitle">ng/mL</span>
      </div>
      <button class="reset-zoom" id="reset-psa" onclick="resetZoom('psa')">Reset Zoom</button>
    </div>
    <div class="chart-wrap"><canvas id="chart-psa"></canvas></div>
  </div>

  <div id="panel-lipids" class="chart-card">
    <div class="chart-header">
      <div class="chart-header-left">
        <span class="chart-title">Lipid Panel</span>
        <span class="chart-subtitle">mg/dL</span>
      </div>
      <button class="reset-zoom" id="reset-lipids" onclick="resetZoom('lipids')">Reset Zoom</button>
    </div>
    <div class="chart-wrap"><canvas id="chart-lipids"></canvas></div>
  </div>

  <div id="panel-glycemic" class="chart-card">
    <div class="chart-header">
      <div class="chart-header-left">
        <span class="chart-title">Glycemic Control</span>
        <span class="chart-subtitle">A1C % · Glucose mg/dL</span>
      </div>
      <button class="reset-zoom" id="reset-glycemic" onclick="resetZoom('glycemic')">Reset Zoom</button>
    </div>
    <div class="chart-wrap"><canvas id="chart-glycemic"></canvas></div>
  </div>

  <div id="panel-heme" class="chart-card">
    <div class="chart-header">
      <div class="chart-header-left">
        <span class="chart-title">Hematology</span>
        <span class="chart-subtitle">Hgb g/dL · Hct %</span>
      </div>
      <button class="reset-zoom" id="reset-heme" onclick="resetZoom('heme')">Reset Zoom</button>
    </div>
    <div class="chart-wrap"><canvas id="chart-heme"></canvas></div>
  </div>

  <div class="events-legend">
    <span class="events-legend-title">Events</span>
    <div class="event-item"><div class="event-dot" style="background:#ef4444"></div><span class="event-label" style="color:#ef4444">Biopsy</span></div>
    <div class="event-item"><div class="event-dot" style="background:#3b82f6"></div><span class="event-label" style="color:#3b82f6">MRI</span></div>
    <div class="event-item"><div class="event-dot" style="background:#f59e0b"></div><span class="event-label" style="color:#f59e0b">Ca Score</span></div>
    <div class="event-item"><div class="event-dot" style="background:#10b981"></div><span class="event-label" style="color:#10b981">Medication</span></div>
  </div>

  <div class="zoom-hint">Drag on chart to zoom · Scroll wheel to zoom · Double-click to reset</div>
</div>

<script>
const RAW = [
  { date: "2000-09-12", psa: 1.3 },
  { date: "2002-11-20", psa: 1.1 },
  { date: "2005-04-20", psa: 1.1 },
  { date: "2006-09-20", psa: 2.6 },
  { date: "2006-12-15", psa: 3.2 },
  { date: "2007-04-03", psa: 1.73, tc: 210, ldl: 139, hdl: 46, glu: 114, a1c: 5.9 },
  { date: "2007-10-01", psa: 2.2, tc: 175, ldl: 126, hdl: 37, glu: 119, a1c: 5.8 },
  { date: "2008-04-16", psa: 2.3, tc: 178, ldl: 128, hdl: 34, a1c: 6.2 },
  { date: "2008-12-01", psa: 2.4, tc: 177, ldl: 124, hdl: 40, glu: 106, a1c: 5.8 },
  { date: "2009-03-31", psa: 2.6, tc: 174, ldl: 122, hdl: 33, glu: 100, a1c: 6.0 },
  { date: "2009-07-07", psa: 2.2, tc: 178, ldl: 129, hdl: 32, glu: 121, a1c: 5.9 },
  { date: "2009-09-03", psa: 2.15, tc: 182, ldl: 119, hdl: 47, glu: 107 },
  { date: "2010-04-21", psa: 3.4, tc: 167, ldl: 108, hdl: 40, glu: 111 },
  { date: "2010-11-06", psa: 3.2 },
  { date: "2011-04-11", psa: 3.5, tc: 192, ldl: 133, hdl: 40, glu: 108, a1c: 6.0 },
  { date: "2011-11-16", psa: 2.6, tc: 192, ldl: 133, hdl: 42, glu: 112, a1c: 6.0 },
  { date: "2012-04-20", psa: 2.7, tc: 201, ldl: 148, glu: 105, a1c: 5.2 },
  { date: "2012-07-17", psa: 2.8, glu: 99 },
  { date: "2013-05-23", psa: 2.41, tc: 189, ldl: 114, hdl: 49, trig: 131, glu: 110, a1c: 5.9 },
  { date: "2013-09-16", psa: 2.4, tc: 152, ldl: 96, hdl: 43, trig: 64, glu: 89, a1c: 6.0 },
  { date: "2014-03-20", psa: 2.5, tc: 155, ldl: 98, hdl: 45, trig: 58, glu: 103, a1c: 5.6 },
  { date: "2014-09-12", psa: 3.1, tc: 153, ldl: 88, hdl: 46, trig: 96, glu: 111, a1c: 5.7 },
  { date: "2014-12-09", psa: 2.9, tc: 166, ldl: 95, hdl: 50, trig: 105, glu: 109, a1c: 5.9 },
  { date: "2015-06-16", psa: 3.2, tc: 164, ldl: 95, hdl: 51, trig: 88, glu: 109, a1c: 5.9 },
  { date: "2015-09-09", psa: 2.9, tc: 152, ldl: 89, hdl: 47, trig: 80, glu: 114, a1c: 5.9 },
  { date: "2016-02-02", psa: 3.0, tc: 184, ldl: 110, hdl: 56, trig: 88, glu: 117, a1c: 6.1 },
  { date: "2016-08-25", psa: 2.7, tc: 172, ldl: 104, hdl: 52, trig: 78, glu: 114, a1c: 6.0 },
  { date: "2017-03-30", psa: 3.8, tc: 169, ldl: 96, hdl: 49, trig: 119, glu: 116, a1c: 6.1 },
  { date: "2017-09-05", psa: 3.7, tc: 177, ldl: 115, hdl: 49, trig: 65, glu: 123, a1c: 5.9 },
  { date: "2018-05-10", psa: 3.0, tc: 160, ldl: 96, hdl: 38, trig: 132, hct: 43.3, hgb: 15.0, glu: 143, a1c: 6.0 },
  { date: "2018-11-03", psa: 3.0, tc: 192, ldl: 109, hdl: 42, trig: 203, hct: 44.4, hgb: 15.5, glu: 126, a1c: 6.1 },
  { date: "2019-06-05", psa: 2.5, tc: 156, ldl: 99, hdl: 40, trig: 85, hct: 43.9, hgb: 14.7, glu: 112, a1c: 6.1 },
  { date: "2020-02-04", psa: 2.5, tc: 168, ldl: 102, hdl: 39, trig: 137, hct: 46.1, hgb: 15.4, glu: 128, a1c: 6.1 },
  { date: "2020-09-23", psa: 3.4, tc: 172, ldl: 103, hdl: 45, trig: 121, hct: 44.7, hgb: 14.7, glu: 118, a1c: 5.9 },
  { date: "2021-01-20", psa: 2.4, tc: 148, ldl: 77, hdl: 50, trig: 107, hct: 40.7, hgb: 13.8, glu: 115, a1c: 5.6 },
  { date: "2021-06-30", psa: 2.8, tc: 144, ldl: 80, hdl: 50, trig: 69, hct: 43.1, hgb: 14.4, glu: 108, a1c: 5.7 },
  { date: "2021-10-14", psa: 2.4, tc: 167, ldl: 98, hdl: 52, trig: 85, hct: 40.8, hgb: 14.0, glu: 102, a1c: 5.6 },
  { date: "2022-05-05", psa: 2.6, tc: 159, ldl: 100, hdl: 44, trig: 76, hct: 41.3, hgb: 13.9, a1c: 5.8 },
  { date: "2022-11-29", psa: 4.1, tc: 160, ldl: 97, hdl: 49, trig: 71, hct: 40.8, hgb: 13.6, a1c: 5.9 },
  { date: "2023-06-05", psa: 3.5, tc: 154, ldl: 94, hdl: 43, trig: 85, hct: 42.7, hgb: 14.1, glu: 120, a1c: 5.9 },
  { date: "2023-12-13", psa: 3.7, tc: 161, ldl: 97, hdl: 49, trig: 81, hct: 42.1, hgb: 14.0, glu: 104, a1c: 6.0 },
  { date: "2024-08-22", psa: 3.15, tc: 172, ldl: 112, hdl: 45, trig: 81, hct: 43.8, hgb: 14.3, glu: 118, a1c: 6.1 },
  { date: "2025-05-30", psa: 3.0, tc: 142, ldl: 84, hdl: 46, trig: 58, hct: 42.7, hgb: 14.2, glu: 94, a1c: 6.1 },
  { date: "2025-10-15", psa: 3.0, tc: 157, ldl: 92, hdl: 51, trig: 70, hct: 43.0, hgb: 14.6, glu: 114, a1c: 5.9 },
  { date: "2026-01-16", psa: 3.7, tc: 98, ldl: 25, hdl: 59, trig: 60, hct: 44.1, hgb: 14.5, glu: 120, a1c: 5.8 },
];

const toPoints = (key) => RAW.filter(r => r[key] != null).map(r => ({ x: new Date(r.date), y: r[key] }));

Chart.defaults.color = '#94a3b8';
Chart.defaults.font.family = "'IBM Plex Sans', sans-serif";
Chart.defaults.font.size = 11;
Chart.defaults.elements.point.radius = 3;
Chart.defaults.elements.point.hoverRadius = 6;
Chart.defaults.elements.line.tension = 0.3;
Chart.defaults.elements.line.borderWidth = 2;

const charts = {};
const dateMin = new Date('1999-06-01');
const dateMax = new Date('2026-06-01');

const baseXAxis = {
  type: 'time',
  min: dateMin,
  max: dateMax,
  time: { unit: 'year', displayFormats: { year: 'yyyy', month: 'MMM yy' } },
  grid: { color: '#1e293b' },
  ticks: { font: { size: 10 }, maxRotation: 0 },
};

const baseYAxis = (min, max, label) => ({
  min, max,
  grid: { color: '#1e293b' },
  ticks: { font: { size: 10 } },
  title: { display: true, text: label, font: { size: 10 }, padding: 2 },
});

const zoomOpts = (chartId) => ({
  pan: { enabled: true, mode: 'x', threshold: 5, modifierKey: null },
  zoom: {
    pinch: { enabled: true },
    wheel: { enabled: true, modifierKey: null },
    drag: { enabled: true, backgroundColor: 'rgba(59,130,246,0.15)', borderColor: '#3b82f6', borderWidth: 1 },
    mode: 'x',
    onZoomComplete: () => { document.getElementById('reset-' + chartId).classList.add('visible'); },
  },
  limits: { x: { min: dateMin.getTime(), max: dateMax.getTime() } },
});

function resetZoom(id) {
  charts[id].resetZoom();
  document.getElementById('reset-' + id).classList.remove('visible');
}

const ds = (label, data, color, opts = {}) => ({
  label, data,
  borderColor: color,
  backgroundColor: color + '20',
  pointBackgroundColor: color,
  pointBorderColor: color,
  spanGaps: true,
  ...opts,
});

const vLine = (date, color, label, pos = 'start') => ({
  type: 'line',
  xMin: new Date(date), xMax: new Date(date),
  borderColor: color, borderWidth: 1.5, borderDash: [4, 4],
  label: {
    display: true, content: label, position: pos,
    backgroundColor: '#111827ee', color: color,
    font: { size: 9, weight: 'bold', family: "'JetBrains Mono', monospace" },
    padding: { x: 5, y: 3 }, borderRadius: 4,
  },
});

const hLine = (y, color, label, yAxisID) => ({
  type: 'line',
  yMin: y, yMax: y, yScaleID: yAxisID || 'y',
  borderColor: color + '80', borderWidth: 1, borderDash: [6, 3],
  label: {
    display: true, content: label, position: 'end',
    backgroundColor: '#111827ee', color: color,
    font: { size: 9 }, padding: { x: 4, y: 2 }, borderRadius: 3,
  },
});

// ── Stats ───────────────────────────────────────────────────────────────
const L = RAW[RAW.length - 1], P = RAW[RAW.length - 2];
const stats = [
  { label: "PSA", value: L.psa, unit: "ng/mL", color: "#f59e0b", trend: `${L.psa > P.psa ? "↑" : "↓"} ${P.psa}`, tc2: L.psa > P.psa ? "#fbbf24" : "#10b981" },
  { label: "LDL", value: L.ldl, unit: "mg/dL", color: "#10b981", trend: `↓ ${P.ldl}`, tc2: "#10b981" },
  { label: "HDL", value: L.hdl, unit: "mg/dL", color: "#10b981", trend: `↑ ${P.hdl}`, tc2: "#10b981" },
  { label: "A1C", value: L.a1c, unit: "%", color: L.a1c > 5.7 ? "#fbbf24" : "#10b981", trend: `↓ ${P.a1c}`, tc2: "#10b981" },
  { label: "Ca Score", value: "387", unit: "AU", color: "#f59e0b", trend: "↑ 223 ('18)", tc2: "#fbbf24" },
  { label: "TC", value: L.tc, unit: "mg/dL", color: "#10b981", trend: `↓ ${P.tc}`, tc2: "#10b981" },
];

document.getElementById('stats-row').innerHTML = stats.map(s => `
  <div class="stat-card">
    <div class="stat-label">${s.label}</div>
    <div><span class="stat-value" style="color:${s.color}">${s.value}</span><span class="stat-unit">${s.unit}</span></div>
    <div class="stat-trend" style="color:${s.tc2}">${s.trend}</div>
  </div>`).join('');

// ── Tabs ────────────────────────────────────────────────────────────────
const panelIds = ['psa', 'lipids', 'glycemic', 'heme'];
[{ id: 'all', label: 'All' }, { id: 'psa', label: 'PSA' }, { id: 'lipids', label: 'Lipids' },
 { id: 'glycemic', label: 'Glycemic' }, { id: 'heme', label: 'Hematology' }].forEach(t => {
  const btn = document.createElement('button');
  btn.className = 'tab' + (t.id === 'all' ? ' active' : '');
  btn.textContent = t.label;
  btn.dataset.id = t.id;
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(b => b.classList.toggle('active', b.dataset.id === t.id));
    panelIds.forEach(pid => {
      document.getElementById('panel-' + pid).classList.toggle('hidden', t.id !== 'all' && t.id !== pid);
    });
    setTimeout(() => Object.values(charts).forEach(c => c.resize()), 50);
  });
  document.getElementById('tabs').appendChild(btn);
});

// ── PSA ─────────────────────────────────────────────────────────────────
charts.psa = new Chart(document.getElementById('chart-psa'), {
  type: 'line',
  data: { datasets: [ds('Total PSA', toPoints('psa'), '#f59e0b')] },
  options: {
    responsive: true, maintainAspectRatio: true, aspectRatio: 1.8,
    interaction: { mode: 'nearest', intersect: false },
    scales: { x: baseXAxis, y: baseYAxis(0, 5, 'ng/mL') },
    plugins: {
      zoom: zoomOpts('psa'),
      annotation: { annotations: {
        lim: hLine(4.0, '#ef4444', 'PSA 4.0'),
        bx1: vLine('2006-12-22', '#ef4444', 'Biopsy'),
        bx2: vLine('2010-05-06', '#ef4444', 'Biopsy'),
        m1: vLine('2017-04-18', '#3b82f6', 'MRI'),
        m2: vLine('2020-10-05', '#3b82f6', 'MRI'),
        m3: vLine('2022-12-05', '#3b82f6', 'MRI'),
        bx3: vLine('2022-12-06', '#ef4444', 'Biopsy', 'end'),
      }},
      legend: { position: 'bottom', labels: { boxWidth: 10, padding: 12, font: { size: 11 } } },
    },
  },
});

// ── Lipids ──────────────────────────────────────────────────────────────
charts.lipids = new Chart(document.getElementById('chart-lipids'), {
  type: 'line',
  data: { datasets: [
    ds('Total Cholesterol', toPoints('tc'), '#3b82f6'),
    ds('LDL', toPoints('ldl'), '#ef4444'),
    ds('HDL', toPoints('hdl'), '#10b981'),
    ds('Triglycerides', toPoints('trig'), '#8b5cf6'),
  ]},
  options: {
    responsive: true, maintainAspectRatio: true, aspectRatio: 1.8,
    interaction: { mode: 'nearest', intersect: false },
    scales: { x: baseXAxis, y: baseYAxis(0, 240, 'mg/dL') },
    plugins: {
      zoom: zoomOpts('lipids'),
      annotation: { annotations: {
        tc: hLine(200, '#3b82f6', 'TC 200'),
        ldl: hLine(100, '#ef4444', 'LDL 100'),
        hdl: hLine(40, '#10b981', 'HDL 40'),
        trig: hLine(150, '#8b5cf6', 'Trig 150'),
        ca1: vLine('2018-01-01', '#f59e0b', 'Ca:223 LAD=189 LCx=34.5'),
        ca2: vLine('2025-07-01', '#f59e0b', 'Ca:387 LAD=240 LCx=74 RCA=8 PDA=20', 'end'),
        rx1: vLine('2025-07-01', '#10b981', 'Crestor daily', 'center'),
        rx2: vLine('2025-10-01', '#22d3ee', 'Repatha q2wk', 'center'),
      }},
      legend: { position: 'bottom', labels: { boxWidth: 10, padding: 12, font: { size: 11 } } },
    },
  },
});

// ── Glycemic ────────────────────────────────────────────────────────────
charts.glycemic = new Chart(document.getElementById('chart-glycemic'), {
  type: 'line',
  data: { datasets: [
    ds('HbA1c (%)', toPoints('a1c'), '#f97316', { yAxisID: 'y' }),
    ds('Glucose (mg/dL)', toPoints('glu'), '#06b6d4', { yAxisID: 'y2' }),
  ]},
  options: {
    responsive: true, maintainAspectRatio: true, aspectRatio: 1.8,
    interaction: { mode: 'nearest', intersect: false },
    scales: {
      x: baseXAxis,
      y: { ...baseYAxis(4.5, 7, 'A1C %'), position: 'left' },
      y2: { ...baseYAxis(70, 160, 'mg/dL'), position: 'right', grid: { display: false } },
    },
    plugins: {
      zoom: zoomOpts('glycemic'),
      annotation: { annotations: {
        pre: hLine(5.7, '#fbbf24', 'Pre-DM 5.7'),
        dm: hLine(6.5, '#ef4444', 'DM 6.5'),
      }},
      legend: { position: 'bottom', labels: { boxWidth: 10, padding: 12, font: { size: 11 } } },
    },
  },
});

// ── Hematology ──────────────────────────────────────────────────────────
charts.heme = new Chart(document.getElementById('chart-heme'), {
  type: 'line',
  data: { datasets: [
    ds('Hemoglobin (g/dL)', toPoints('hgb'), '#ec4899', { yAxisID: 'y' }),
    ds('Hematocrit (%)', toPoints('hct'), '#a78bfa', { yAxisID: 'y2' }),
  ]},
  options: {
    responsive: true, maintainAspectRatio: true, aspectRatio: 1.8,
    interaction: { mode: 'nearest', intersect: false },
    scales: {
      x: baseXAxis,
      y: { ...baseYAxis(12, 17, 'g/dL'), position: 'left' },
      y2: { ...baseYAxis(36, 50, '%'), position: 'right', grid: { display: false } },
    },
    plugins: {
      zoom: zoomOpts('heme'),
      annotation: { annotations: { low: hLine(13.5, '#ec4899', 'Hgb Low') }},
      legend: { position: 'bottom', labels: { boxWidth: 10, padding: 12, font: { size: 11 } } },
    },
  },
});
</script>
</body>
</html>
